<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <title>Aggregated Results</title>
</head>
<body>
    <h1>Aggregated Movie Preferences</h1>
    <h2>Top 3 Movies:</h2>
    <ol>
        {% for winner in winners %}
            <li>{{ winner }}</li>
        {% endfor %}
    </ol>
    <p><a href="{{ url_for('index') }}">Back to Home</a></p>

    <button id="prevButton" disabled>Previous</button>
    <button id="nextButton" disabled>Next</button>
    <div id="rounds"></div>
    <script>
        let rounds = JSON.parse('{{ votes|tojson|safe }}');
        let userVotes = JSON.parse('{{ my_votes|tojson|safe }}');
        let currentRound = 1;

        function showRound(number) {
            let votes = rounds[number - 1];
            let userVote = userVotes[number - 1];

            // Convert the votes object to an array of [candidate, votes] pairs, then sort it by votes and names
            let sortedVotes = Object.entries(votes).sort((a, b) => {
                let voteDiff = b[1] - a[1];
                if (voteDiff !== 0) {
                    return voteDiff;
                } else {
                    // If votes are equal, sort alphabetically by candidate name
                    return a[0].localeCompare(b[0]);
                }
            });
            let html = `<h2>Round ${number}</h2><ul>`;
            for (let [candidate, votes] of sortedVotes) {
                html += `<li>${candidate}: ${votes} votes`;
                if (userVote.includes(candidate)) {
                    html += ' ðŸ‘ˆ Your vote';
                }
                html += '</li>';
            }
            html += '</ul>';
            document.getElementById('rounds').innerHTML = html;

            // Enable or disable buttons based on the current round
            document.getElementById('prevButton').disabled = (number === 1);
            document.getElementById('nextButton').disabled = (number === rounds.length);
        }

        document.getElementById('prevButton').addEventListener('click', function() {
            if (currentRound > 1) {
                currentRound--;
                showRound(currentRound);
            }
        });

        document.getElementById('nextButton').addEventListener('click', function() {
            if (currentRound < rounds.length) {
                currentRound++;
                showRound(currentRound);
            }
        });

        // Show the first round initially
        showRound(currentRound);
    </script>
</body>
</html>